<!DOCTYPE html>
        <html>
        <head>
            <meta charset="UTF-8">
            <title>&ast;&ast;Automating Azure VM Provisioning&colon; A Story of an Operations Engineer&ast;&ast;</title>
            <style>
/* From extension vscode.github */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

.vscode-dark img[src$=\#gh-light-mode-only],
.vscode-light img[src$=\#gh-dark-mode-only],
.vscode-high-contrast:not(.vscode-high-contrast-light) img[src$=\#gh-light-mode-only],
.vscode-high-contrast-light img[src$=\#gh-dark-mode-only] {
	display: none;
}

</style>
            
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
<style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', system-ui, 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        <style>
.task-list-item {
    list-style-type: none;
}

.task-list-item-checkbox {
    margin-left: -20px;
    vertical-align: middle;
    pointer-events: none;
}
</style>
<style>
:root {
  --color-note: #0969da;
  --color-tip: #1a7f37;
  --color-warning: #9a6700;
  --color-severe: #bc4c00;
  --color-caution: #d1242f;
  --color-important: #8250df;
}

</style>
<style>
@media (prefers-color-scheme: dark) {
  :root {
    --color-note: #2f81f7;
    --color-tip: #3fb950;
    --color-warning: #d29922;
    --color-severe: #db6d28;
    --color-caution: #f85149;
    --color-important: #a371f7;
  }
}

</style>
<style>
.markdown-alert {
  padding: 0.5rem 1rem;
  margin-bottom: 16px;
  color: inherit;
  border-left: .25em solid #888;
}

.markdown-alert>:first-child {
  margin-top: 0
}

.markdown-alert>:last-child {
  margin-bottom: 0
}

.markdown-alert .markdown-alert-title {
  display: flex;
  font-weight: 500;
  align-items: center;
  line-height: 1
}

.markdown-alert .markdown-alert-title .octicon {
  margin-right: 0.5rem;
  display: inline-block;
  overflow: visible !important;
  vertical-align: text-bottom;
  fill: currentColor;
}

.markdown-alert.markdown-alert-note {
  border-left-color: var(--color-note);
}

.markdown-alert.markdown-alert-note .markdown-alert-title {
  color: var(--color-note);
}

.markdown-alert.markdown-alert-important {
  border-left-color: var(--color-important);
}

.markdown-alert.markdown-alert-important .markdown-alert-title {
  color: var(--color-important);
}

.markdown-alert.markdown-alert-warning {
  border-left-color: var(--color-warning);
}

.markdown-alert.markdown-alert-warning .markdown-alert-title {
  color: var(--color-warning);
}

.markdown-alert.markdown-alert-tip {
  border-left-color: var(--color-tip);
}

.markdown-alert.markdown-alert-tip .markdown-alert-title {
  color: var(--color-tip);
}

.markdown-alert.markdown-alert-caution {
  border-left-color: var(--color-caution);
}

.markdown-alert.markdown-alert-caution .markdown-alert-title {
  color: var(--color-caution);
}

</style>
        
        </head>
        <body class="vscode-body vscode-light">
            <h1 id="automating-azure-vm-provisioning-a-story-of-an-operations-engineer"><strong>Automating Azure VM Provisioning: A Story of an Operations Engineer</strong></h1>
<p>Meet Jake, an operations engineer at <strong>TechFusion Corp</strong>. Jake is tasked with automating the process of provisioning virtual machines (VMs) on Microsoft Azure. The goal is to eliminate manual steps, ensure consistency, and reduce deployment times.</p>
<p>Jake's manager emphasizes the importance of following best practices, including modularizing Terraform scripts and ensuring they are reusable. With determination and a clear plan, Jake embarks on this task.</p>
<hr>
<h2 id="the-challenge"><strong>The Challenge</strong></h2>
<p>Jake's task is to:</p>
<ol>
<li>Create a well-structured project with modular Terraform scripts to manage various components like resource groups, networks, and VMs.</li>
<li>Follow best practices for organizing Terraform projects and maintaining code clarity.</li>
</ol>
<hr>
<h2 id="the-workflow"><strong>The Workflow</strong></h2>
<h3 id="step-1-set-up-the-project-directory"><strong>Step 1: Set Up the Project Directory</strong></h3>
<p>Jake starts by organizing the project directory for modularization and scalability.</p>
<pre><code class="language-plaintext">vm-provisioning/
├── modules/
│   ├── resource_group/
│   │   ├── main.tf
│   │   ├── variables.tf
│   │   ├── outputs.tf
│   ├── network/
│   │   ├── main.tf
│   │   ├── variables.tf
│   │   ├── outputs.tf
│   ├── vm/
│       ├── main.tf
│       ├── variables.tf
│       ├── outputs.tf
├── main.tf
├── provider.tf
├── variables.tf
├── outputs.tf
</code></pre>
<p>This structure allows Jake to create reusable modules for different infrastructure components.</p>
<h3 id="step-2-define-the-azure-provider"><strong>Step 2: Define the Azure Provider</strong></h3>
<p>Jake creates a <a href="http://provider.tf">provider.tf</a> file in the root directory to configure Azure as the cloud provider:</p>
<pre><code class="language-plaintext">provider &quot;azurerm&quot; {
  features {}
}
</code></pre>
<p>This enables Terraform to interact with Azure resources.</p>
<h3 id="step-3-create-terraform-modules"><strong>Step 3: Create Terraform Modules</strong></h3>
<p>Jake modularizes the configuration by creating separate modules for resource groups, networks, and virtual machines.</p>
<p>3.1. Resource Group Module</p>
<p>In the modules/resource_group directory:</p>
<pre><code class="language-plaintext">main.tf:
resource &quot;azurerm_resource_group&quot; &quot;rg&quot; {
  name     = var.resource_group_name
  location = var.location
}
</code></pre>
<p><a href="http://variables.tf">variables.tf</a>:</p>
<pre><code class="language-plaintext">variable &quot;resource_group_name&quot; {
  description = &quot;The name of the resource group&quot;
  type        = string
}
variable &quot;location&quot; {
  description = &quot;The Azure region for the resource group&quot;
  type        = string
}
</code></pre>
<p><a href="http://outputs.tf">outputs.tf</a>:</p>
<pre><code class="language-plaintext">output &quot;resource_group_name&quot; {
  value = azurerm_resource_group.rg.name
}
</code></pre>
<p>3.2. Network Module</p>
<p>In the modules/network directory:</p>
<p><a href="http://main.tf">main.tf</a>:</p>
<pre><code class="language-plaintext">resource &quot;azurerm_virtual_network&quot; &quot;vnet&quot; {
  name                = var.vnet_name
  address_space       = var.address_space
  location            = var.location
  resource_group_name = var.resource_group_name
}

resource &quot;azurerm_subnet&quot; &quot;subnet&quot; {
  name                 = var.subnet_name
  resource_group_name  = var.resource_group_name
  virtual_network_name = azurerm_virtual_network.vnet.name
  address_prefixes     = var.subnet_prefix
}
</code></pre>
<p><a href="http://variables.tf">variables.tf</a>:</p>
<pre><code class="language-plaintext">variable &quot;vnet_name&quot; { type = string }
variable &quot;address_space&quot; { type = list(string) }
variable &quot;subnet_name&quot; { type = string }
variable &quot;subnet_prefix&quot; { type = list(string) }
variable &quot;resource_group_name&quot; { type = string }
variable &quot;location&quot; { type = string }
</code></pre>
<p><a href="http://outputs.tf">outputs.tf</a>:</p>
<pre><code class="language-plaintext">output &quot;subnet_id&quot; {
  value = azurerm_subnet.subnet.id
}
</code></pre>
<p>3.3. Virtual Machine Module</p>
<p>In the modules/vm directory:</p>
<p><a href="http://main.tf">main.tf</a>:</p>
<pre><code class="language-plaintext">resource &quot;azurerm_linux_virtual_machine&quot; &quot;vm&quot; {
  name                = var.vm_name
  resource_group_name = var.resource_group_name
  location            = var.location
  size                = var.vm_size
  admin_username      = var.admin_username

  network_interface_ids = var.network_interface_ids

  admin_ssh_key {
    username   = var.admin_username
    public_key = file(var.ssh_key_path)
  }

  os_disk {
    caching              = &quot;ReadWrite&quot;
    storage_account_type = &quot;Standard_LRS&quot;
  }

  source_image_reference {
    publisher = &quot;Canonical&quot;
    offer     = &quot;UbuntuServer&quot;
    sku       = &quot;18.04-LTS&quot;
    version   = &quot;latest&quot;
  }
}
</code></pre>
<p><a href="http://variables.tf">variables.tf</a>:</p>
<pre><code class="language-plaintext">variable &quot;vm_name&quot; { type = string }
variable &quot;resource_group_name&quot; { type = string }
variable &quot;location&quot; { type = string }
variable &quot;vm_size&quot; { type = string }
variable &quot;admin_username&quot; { type = string }
variable &quot;network_interface_ids&quot; { type = list(string) }
variable &quot;ssh_key_path&quot; { type = string }
</code></pre>
<p><a href="http://outputs.tf">outputs.tf</a>:</p>
<pre><code class="language-plaintext">output &quot;vm_id&quot; {
  value = azurerm_linux_virtual_machine.vm.id
}
</code></pre>
<h3 id="sstep-4-integrate-modules-in-the-root-configuration"><strong>SStep 4: Integrate Modules in the Root Configuration</strong></h3>
<p>Jake uses the modules in <a href="http://main.tf">main.tf</a> to define the infrastructure:</p>
<pre><code class="language-plaintext">module &quot;resource_group&quot; {
  source              = &quot;./modules/resource_group&quot;
  resource_group_name = &quot;TechFusion-RG&quot;
  location            = &quot;East US&quot;
}

module &quot;network&quot; {
  source              = &quot;./modules/network&quot;
  vnet_name           = &quot;TechFusion-VNet&quot;
  address_space       = [&quot;10.0.0.0/16&quot;]
  subnet_name         = &quot;TechFusion-Subnet&quot;
  subnet_prefix       = [&quot;10.0.1.0/24&quot;]
  resource_group_name = module.resource_group.resource_group_name
  location            = &quot;East US&quot;
}

module &quot;vm&quot; {
  source               = &quot;./modules/vm&quot;
  vm_name              = &quot;TechFusion-VM&quot;
  resource_group_name  = module.resource_group.resource_group_name
  location             = &quot;East US&quot;
  vm_size              = &quot;Standard_B1s&quot;
  admin_username       = &quot;azureuser&quot;
  network_interface_ids = [module.network.subnet_id]
  ssh_key_path         = &quot;~/.ssh/id_rsa.pub&quot;
}
</code></pre>
<h3 id="step-5-execute-terraform-commands"><strong>Step 5: Execute Terraform Commands</strong></h3>
<p>Jake performs the following steps:</p>
<p>Initialize Terraform:</p>
<pre><code class="language-plaintext">terraform init
</code></pre>
<p>Preview the infrastructure changes:</p>
<pre><code class="language-plaintext">terraform plan
</code></pre>
<p>Apply the configuration:</p>
<pre><code class="language-plaintext">terraform apply
</code></pre>
<p>Confirm the changes by typing yes.</p>
<p>Step 6: Verify and Clean Up
Jake logs into the Azure portal to confirm the resources are created.
He SSHs into the VM to verify access:</p>
<pre><code class="language-plaintext">ssh azureuser@&lt;public_ip_address&gt;
</code></pre>
<p>To clean up resources, Jake runs:</p>
<pre><code class="language-plaintext">terraform destroy
</code></pre>
<p><strong>Outcome</strong></p>
<p>Jake successfully automated Azure VM provisioning by:</p>
<p>Creating reusable and modular Terraform scripts.
Organizing the project with best practices.
Ensuring scalability and consistency across deployments.
Jake's efforts streamlined operations and reduced deployment times, showcasing the power of Terraform in modern DevOps workflows.</p>

            
            
        </body>
        </html>